# V3.2 Session Binding

## 3.2.1 Verify the application generates a new session token on user authentication

Op het moment dat er een nieuwe authenticatie poging is, is het belangrijk dat er ook een nieuwe sessie token wordt gegenereerd. Dit om te voorkomen dat sessie tokens voorspelbaar zijn.

### Hoe te testen?

#### Optie 1 (manueel)

1. Log in met een gebruiker.
2. Kijk naar de token.
3. Log de huidige gebruiker uit of start een nieuwe (private) browser sessie op.
4. Log opnieuw in met de gebruiker.
5. Kijk of tokens verschillend zijn.

### Hoe te implementeren?

Maak gebruik van standard frameworks voor authenticatie.

## 3.2.2 Verify that session tokens possess at least 64 bits of entropy

> [!NOTE]
> In de nieuwe versie van ASVS (5.0) is deze entropy verhoogd naar 128. Daarom is onze aanbeveling om te streven naar 128 bits of entropy.

Waarom 64 bit, op het moment van schrijven duurt het ongeveer 292 jaar (met de aanname dat je 10.000 pogingen per seconde kunt doen) om te raden (zie <https://owasp.org/www-community/vulnerabilities/Insufficient_Session-ID_Length>). Omdat je wil voorkomen dat token worden geraden is een minimale entropy van 64 bit nodig, meer mag natuurlijk altijd.

### Hoe te testen?

#### Optie 1 (via Burp Suite)

Het bepalen van de entropy met Burp Suite kan met behulp van de Sequencer plugin, uitleg is te vinden via: <https://portswigger.net/burp/documentation/desktop/tools/sequencer/getting-started>

#### Optie 2 (via script)

Een Python Gist kan worden gevonden op <https://gist.github.com/4k1/6fbe670807db1d48407685d6cc46b0af>. Deze kan gebruikt worden om de entropy van tokens te analyseren.

### Hoe te implementeren?

1. Maak gebruik van standaarden binnen je authenticatie framework, creÃ«er nooit zelf tokens.
2. Indien een token gebruikt moet worden, gebruik een standaard zoals uuid4.

Voor meer informatie zie, <https://owasp.org/www-community/vulnerabilities/Insufficient_Session-ID_Length>

## 3.2.3 Verify the application only stores session tokens in the browser using secure methods such as appropriately secured cookies

Om de sessie bij te houden dient deze op geslagen te worden in de browser. Het is belangrijk dat dit veilig gebeurd, dit om te voorkomen dat gebruikers of aanvallers er bij kunnen.

### Hoe te testen?

#### Optie 1 (manueel)

1. Kijk of de techniek die gebruikt wordt om sessies op te slaan bestaat uit:
    - localStorage
    - sessionStorage
    - IndexedDB
    - HTTP cookies
2. Indien HTTP Cookies worden gebruikt, onderzoek of deze de volgende instellingen heeft:
    - **__Host- prefix:** Cookies die beginnen met __Host- moeten worden ingesteld met de Secure  flag, moeten afkomstig zijn van een veilige pagina (HTTPS), mogen niet naar subdomeinen worden gestuurd en het pad moet / zijn.
    - **path=/:** zorg dat de cookie geldig is voor alle pagina's op de website
    - **Secure:** De cookie wordt alleen verzonden via HTTPS-verbindingen.
    - **HttpOnly:** De cookie kan niet worden gewijzigd door JavaScript (Minder impact XXS aanval).
    - **SameSite=Strict:** De cookie wordt alleen verzonden naar de website die de cookie heeft verstuurd.

### Hoe te implementeren?

1. Maak gebruik van localStorage, sessionStorage, IndexedDB of HTTP Cookies.
2. Indien HTTP Cookies, volg [Best Practice - HTTP Cookies](../Best%20Practices/Best%20Practice%20-%20HTTP%20Cookies.md)
