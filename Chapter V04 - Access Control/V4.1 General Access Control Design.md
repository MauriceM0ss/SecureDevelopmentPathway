# V4.1 General Access Control Design

## 4.1.1 Verify that the application enforces access control rules on a trusted service layer, especially if client-side access control is present and could be bypassed

De browser van een gebruiker is niet te vertrouwen, deze is namelijk in controle van de gebruiker of een eventuele aanvaller. Daarom is het belangrijk dat toegang wordt bepaald op de server. Deze controle dient te gebeuren bij elke actie die wordt uitgevoerd om te controleren of de rechten daadwerkelijk aanwezig zijn.

 > [!NOTE]
 > Er niets mis is met client-side validatie inclusief terugkoppeling vanuit de browser op bijvoorbeeld de invoer van een veld (bijv. postcode/telefoonnummer check), maar deze check moet ook op de server moet plaatsvinden omdat deze vanuit de browser omzeilt kan worden. Client-side checks mogen uiteraard wel gebruikt worden vanuit gebruikersvriendelijkheids-oogpunt, maar de security maatregel zit wel op de server.

### Hoe te testen?

#### Optie 1 (Abuse Cases)

Schrijf abuse cases om automatisch te controleren of acties zonder controle uitgevoerd kunnen worden.

#### Optie 2 (via Pentest)

Vraag een Pentest aan om te controleren of acties niet zonder benodigde rechten uitgevoerd kunnen worden.

### Hoe te implementeren?

1. Definieer een matrix met de acties die per gebruikersrol uitgevoerd mogen worden.
2. Voeg checks toe bij elke actie om te controleren of de gebruikersrol binnen de matrix valt.

## 4.1.2 Verify that all user and data attributes and policy information used by access controls cannot be manipulated by end users unless specifically authorized

Vaak zijn er veel waardes opgeslagen van een gebruiker. Dit kan uiteenlopen van BSN tot email tot rekeningnummer. Veel van deze waardes dienen echter niet zomaar aangepast te kunnen worden. Toch komt het nog wel eens voor dat deze waardes naar de server worden verstuurd en vervolgens de ingestuurde waardes overnemen, e.g. het aanpassen van een BSN nummer. Dit kan natuurlijk grote gevolgen met zich meebrengen omdat hierdoor informatie over een gebruiker foutief in het systeem staat.

### Hoe te testen?

#### Optie 1 (manueel)

Controleer dat er geen input data wordt verstuurd naar de server die niet door een gebruiker bepaald mag worden.

### Hoe te implementeren?

1. Definieer welke waardes er door gebruikers aangepast mogen worden.
2. Bij meer gevoelige data implementeer een extra verificatie stap (e-mail verificatie, insturen ticket etc.).
3. Verwijder logica die afwijkt van bovenstaande.

## 4.1.3 Verify that the principle of least privilege exists - users should only be able to access functions, data files, URLs, controllers, services, and other resources, for which they possess specific authorization. This implies protection against spoofing and elevation of privilege

Het principe van least privilege houdt in dat een gebruiker de minimale rechten toegewezen krijgt om zijn taken te kunnen voldoen. Dus alleen toegang tot bestanden behorende bij zijn taak, het alleen mogen wijzigen van data wanneer dit echt benodigd is etc. Voor meer informatie over dit principe zie <https://cheatsheetseries.owasp.org/cheatsheets/Secure_Product_Design_Cheat_Sheet.html>.

### Hoe te testen?

#### Optie 1 (manueel)

Controleer de rechten die aan accounts zijn toegekend en kijk of deze minimaal zijn ingesteld.

### Hoe te implementeren?

Geef accounts altijd de minimale rechten benodigd.

* Een stap hiervoor is het maken van een rollenmatrix waarin staat beschreven welke acties/pagina's door welke gebruiker uitgevoerd mogen worden.

## 4.1.5 Verify that access controls fail securely including when an exception occurs

Wanneer er een fout ontstaat in de logica is er vaak logica geschreven die bepaalt hoe de vervolg stappen worden genomen. In het geval van fail securely zorg je er voor dat indien er iets mis gaat in het process de verwacht uitkomst negatief is. Bijvoorbeeld bij een autorisatie check dient is_authorized initieel gezet te worden op false. Indien er iets mis gaat dient deze waarde ook terug gegeven te worden waardoor het niet mogelijk is door een configuratie fout dat een gebruiker onbedoeld rechten krijgt.

### Hoe te testen?

#### Optie 1 (via SAST)

Maak gebruik van een SAST tooling om te controleren voor code smells.

### Hoe te implementeren?

Probeer te programmeren met een "Fail securely" manier van denken. Meer informatie kan worden gevonden op: <https://cheatsheetseries.owasp.org/cheatsheets/Secure_Product_Design_Cheat_Sheet.html>
