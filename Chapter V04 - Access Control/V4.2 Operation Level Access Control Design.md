# V4.2 Operation Level Access Control Design

## 4.2.1 Verify that sensitive data and APIs are protected against Insecure Direct Object Reference (IDOR) attacks targeting creation, reading, updating and deletion of records, such as creating or updating someone else's record, viewing everyone's records, or deleting all records

IDOR aanvallen ontstaan wanneer een applicatie (website, API, etc.) de gebruikersinvoer direct wordt gebruikt voor het opvragen van informatie. Hierdoor kan o.a. misbruik van worden gemaakt om toegangsbeveiliging te omzeilen. Een voorbeeld: neem het volgende endpoint /getUser?id=5. Indien een normale gebruiker 'id=5' heeft in de database, is er te voorspellen dat de administrator waarschijnlijk 'id=1' of 'id=0' heeft. Door het aanpassen van de identifier kunnen er additionele rechten worden verkregen, kan er extra data worden opgevraagd en/of acties worden uitgevoerd. Een aantal jaar geleden is via deze kwetsbaarheid de Prinsjesdag nota te vroeg gelekt (als voorbeeld:  /Miljoenennota2023.pdf werd aangepast naar /Miljoenennota2024.pdf).

Om deze reden is het belangrijk dat er per verzoek in de context van het verzoek wordt gecontroleerd of een gebruiker de informatie mag inzien. Het gebruik van complexere ID's zodat gebruikers deze niet zo maar kunnen raden (bijv. UUID) is 'security by obscurity' en niet de gewenste oplossing.

### Hoe te testen?

#### Optie 1 (via code)

1. Indexeer de API paths waar input gebaseerd op een ID of bulk acties gebeuren
2. Loop na dat deze acties autorisatie op ID controleren.
3. Loop na dat de bulk acties een extra verificatie stap hebben.
4. Richt logging in op deze acties om te kunnen monitoren op afwijkingen.

#### Optie 2 (via Pentest)

Vraag een Pentest aan op de API of Webapplicatie

### Hoe te implementeren?

Volg de instructies op: <https://cheatsheetseries.owasp.org/cheatsheets/Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html>

## 4.2.2 Verify that the application or framework enforces a strong anti-CSRF mechanism to protect authenticated functionality, and effective anti-automation or anti-CSRF protects unauthenticated functionality

CSRF komt vanwege de moderne frameworks gelukkig een stuk minder voor. Maar de impact is zeer groot. De manier waarop browsers werken is dat ze automatisch de sessie cookies mee sturen op het moment dat je verbinding maakt met een website, dit geldt ook als het verzoek wordt gedaan vanuit een andere website. Hierdoor kun je, indien een gebruiker op een website is ingelogd, vanuit zijn naam acties uitvoeren. Als dit een admin is kun je bijvoorbeeld nieuwe admin gebruikers aanmaken. Hier zijn verschillende mitigaties voor, waaronder security headers maar de veiligste manier blijft om CSRF tokens te gebruiken om deze aanval te voorkomen.

### Hoe te testen?

#### Optie 1 (via code)

1. Indexeer binnen de web-applicatie acties waar autorisatie benodigd is.
2. Controleer of deze een CSRF token verificatie check doen.

#### Optie 2 (via Pentest)

Vraag een Pentest aan.

### Hoe te implementeren?

Maak gebruik van de CSRF opties van het gebruikte framework.

Voor meer informatie zie <https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html>
