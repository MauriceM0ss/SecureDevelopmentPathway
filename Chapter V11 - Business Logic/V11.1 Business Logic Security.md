# V11.1 Business Logic Security

## 11.1.1 Verify that the application will only process business logic flows for the same user in sequential step order and without skipping steps

Indien een proces wordt doorlopen is het belangrijk om te controleren dat het hierbij niet mogelijk is een stap over te slaan, denk bijvoorbeeld aan het overslaan van de "zijn er plekken vrij" check bij het reserveren van kaartjes, hierdoor is het mogelijk om toch kaartjes te kopen zonder dat deze nog beschikbaar zijn.

### Hoe te testen?

#### Optie 1 (manueel)

1. Stel vast hoe de normale happy flow loopt
2. Definieer deze in e.g. een Postman script. (Zie: <https://learning.postman.com/docs/tests-and-scripts/write-scripts/intro-to-scripts/>)
3. Probeer acties in een verkeerde volgorde uit te voeren.

Voor meer informatie zie: [Testing for the Circumvention of Work Flows](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/10-Business_Logic_Testing/06-Testing_for_the_Circumvention_of_Work_Flows)

#### Optie 2 (automatisch)

1. Stel vast hoe de normale happy flow loopt.
2. Schrijf abuse cases die stappen uit de happy flow proberen over te slaan of om te draaien.
3. Kijk of dit succesvol lukt en los eventuele problemen op.

### Hoe te implementeren?

Om dit te implementeren is het essentieel dat er eerst duidelijk is wat de normale happy flow is. Vervolgens dienen er controles ingebouwd te worden die ervoor zorgen dat de gebruikers elke stap in het werkproces in de juiste volgorde voltooien en aanvallers ervan weerhouden om stappen in de workflow over te slaan.

## 11.1.2 Verify that the application will only process business logic flows with all steps being processed in realistic human time, i.e. transactions are not submitted too quickly

Vaak kunnen bots uitvoeren in een snelheid die niet menselijk is. Hierdoor is het bijvoorbeeld mogelijk om een onrealistische hoeveelheid verzoeken in te dienen in een zeer korte tijd waardoor applicaties niet meer goed functioneren. Bijvoorbeeld het indienen van een grote hoeveelheid claims waardoor de server erachter omvalt.

### Hoe te testen?

#### Optie 1 (manueel)

1. Stel vast hoe de normale happy flow loopt
2. Definieer deze in e.g. Postman scripts
3. Voer deze scripts meerdere keren in korte tijd uit.
4. Onderzoek het resultaat.

### Hoe te implementeren?

1. Definieer de normale doorlooptijd van een proces.
2. Stel controle's in die worden geactiveerd als mensen ruim van deze tijd afwijken. Let hierbij op dat het echt gaat om onrealistisch gedrag, e.g. elke 10 ms.

## 11.1.3 Verify the application has appropriate limits for specific business actions or transactions which are correctly enforced on a per user basis

In het geval dat een actie maar een gelimiteerd aantal keer kan worden uitgevoerd dient dit afgedwongen te worden per gebruiker. Dit om te voorkomen dat een gebruiker bewust of onbewust acties of transacties uitvoert die niet meer zouden mogen.

### Hoe te testen?

#### Optie 1 (manueel)

1. Stel een happy flow vast van een actie die eenmalig of een maximaal aantal keer kan worden uitgevoerd.
2. Definieer deze in e.g. Postman scripts. (Zie: <https://learning.postman.com/docs/tests-and-scripts/write-scripts/intro-to-scripts/>)
3. Voer deze scripts meerdere keren uit (meer dan het maximaal)
4. Onderzoek het resultaat.

### Hoe te implementeren?

1. Definieer hoe vaak acties en transacties maximaal uitgevoerd mogen worden.
2. Bouw checks in als hier van af wordt gewogen.

## 11.1.4 Verify that the application has anti-automation controls to protect against excessive calls such as mass data exfiltration, business logic requests, file uploads or denial of service attacks

In veel gevallen is het meermaals aanroepen van functionaliteit niet logisch, denk hierbij aan inlog maar ook het opvragen van (veel) informatie. Het doorlopen van 100en gebruikers ID's om te testen of deze bestaan is in veel gevallen geen normaal gedrag.

### Hoe te testen?

#### Optie 1 (manueel)

1. Stel scripts op in e.g. Postman voor het uitvoeren van specifieke acties
2. Voer deze actie meermaals uit en kijk hoe de applicatie reageert.

### Hoe te implementeren?

Limiteer het aantal verzoeken dat maximaal kan worden gedaan in een vooraf bepaalde periode.

Voor meer informatie zie: [Denial of Service Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html#rate-limiting)

## 11.1.5 Verify the application has business logic limits or validation to protect against likely business risks or threats, identified using threat modeling or similar methodologies

Een van de beste beveiliging die je kunt doen is vooraf nadenken wat de bedrijfsrisico's kunnen zijn en deze afvangen. Door vroegtijdig in het proces dit mee te nemen kun je limiteren wat een gebruiker kan waardoor de kans op risico's wordt verminderd.

### Hoe te testen?

#### Optie 1 (via abuse cases)

1. Stel abuse cases op gebaseerd op de threat modeling sessie.
2. Voer deze abuse case uit op de applicatie.

#### Optie 2 (via security assessment)

Voer een security assessment uit.

### Hoe te implementeren?

1. Stel vast hoe de normale happy flow loopt
2. Voer threat modeling uit op deze flow.
3. Implementeer checks en mitigates tegen mogelijk gevonden risico's.

Voor meer informatie zie: [Testing for the Circumvention of Work Flows](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/10-Business_Logic_Testing/06-Testing_for_the_Circumvention_of_Work_Flows)
