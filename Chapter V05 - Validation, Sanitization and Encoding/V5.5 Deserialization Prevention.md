# V5.5 Deserialization Prevention

## 5.5.1 Verify that serialized objects use integrity checks or are encrypted to prevent hostile object creation or data tampering

Veel programmeertalen en frameworks maken gebruik van serialized objecten om deze als data te kunnen versturen voor bijvoorbeeld opslag of communicatie. Als iemand in staat is om deze serialized data in te zien of te bewerken kan dit mogelijk invloed hebben op de werking en gevoeligheid van de applicatie.

### Hoe te testen?

#### Optie 1 (via Pentest)

Vraag een Pentest aan.

#### Optie 2 (manueel)

Portswigger heeft een uitgebreid artikel geschreven over hoe dit type aanval werkt en kunt misbruiken <https://portswigger.net/web-security/deserialization>

#### Optie 3 (via SAST)

Maak gebruik van een SAST tool om te scannen voor serialized code smells.

### Hoe te implementeren?

Maak gebruik van de nieuwste versie van framework en schrijf geen eigen functies voor serialized objects.

Voor meer informatie zie: <https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html>

## 5.5.2 Verify that the application correctly restricts XML parsers to only use the most restrictive configuration possible and to ensure that unsafe features such as resolving external entities are disabled to prevent XML eXternal Entity (XXE) attacks

Door het verkeerd configureren van je XML parser kan het mogelijk zijn om Externe Entiteiten, a.k.a DTD objecten in te laden. Deze objecten maken het echter ook mogelijk om commando's uit te voeren op een server, data op te vragen en via de zogenaamde [billion laugh](https://en.wikipedia.org/wiki/Billion_laughs_attack) aanval systemen offline te krijgen.

### Hoe te testen?

#### Optie 1 (via Pentest)

Vraag een Pentest aan.

#### Optie 2 (manueel)

1. Gebruik een tool zoals <https://www.endpoints.dev/> om een tijdelijke endpoint aan te maken. Let op: Indien het gaat om gevoelige data host je eigen endpoint.
2. Voeg de volgende snippet toe boven de XML en kijk of deze wordt uitgevoerd. Indien dit het geval is zal je endpoint worden aangeroepen door de server.

    ```xml
    <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://f2g9j7hhkax.endpoints.dev"> ]>
    ```

#### Optie 3 (via SAST)

Maak gebruik SAST tooling voor het detecteren van mogelijke missconfiguraties die kunnen leiden tot XXE.

### Hoe te implementeren?

Zorg dat DTD (External Entities) uit staan

Voor meer informatie zie: <https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html>

## 5.5.3 Verify that deserialization of untrusted data is avoided or is protected in both custom code and third-party libraries (such as JSON, XML and YAML parsers)

Het verwerken van serialized data brengt risico's met zich mee. Dit omdat in veel gevallen deze data ook instructies bevat voor de applicatie. Om deze reden is het ook aanbevolen om indien mogelijk te vermijden serialized data van een onvertrouwde bron in te laden. Indien dit toch niet anders kan is het geadviseerd om serialized data op een "veilige" manier in te laden door middel van bijvoorbeeld een allow list.

### Hoe te testen?

#### Optie 1 (via Pentest)

Vraag een Pentest aan.

#### Optie 2 (manueel)

1. Indexeer waar deserialization van data plaats vindt.
2. Onderzoek of dit nodig is.
3. Indien dit nodig is, zorg dat dit op een veilig manier gebeurd, e.g. allow list of het definiÃ«ren van het object type.

#### Optie 3 (via SAST)

Maak gebruik SAST tooling voor het detecteren van mogelijke missconfiguraties die kunnen leiden tot deserialization.

### Hoe te implementeren?

* Volg de best practices als benoemd in <https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html>
* Maak gebruik van de nieuwste versies van erkende frameworks voor het parsen van JSON, XML en YAML.
* Maak gebruik van allow listen om te specificeren wel acties zijn toegestaan.

## 5.5.4 Verify that when parsing JSON in browsers or JavaScript-based backends, JSON.parse is used to parse the JSON document. Do not use eval() to parse JSON

Het gebruik van eval staat toe om Javascript expressies in te voeren. Dit betekend dat indien een malafide gebruiker hier input naar toe kan versturen deze Javascript mogelijk wordt uitgevoerd. Daarom is het belangrijk om parse te gebruiken omdat deze geen Javascript invoer toe laat.

### Hoe te testen?

#### Optie 1 (manueel)

Loop de code door voor JSON.eval() syntax.

#### Optie 2 (via SAST)

Maak een custom rule, of kijk of deze rule beschikbaar is in je SAST tooling en scan de code met gebruik van deze SAST tooling.

### Hoe te implementeren?

Verwijder all referenties naar JSON.eval  en vervang deze met JSON.parse
