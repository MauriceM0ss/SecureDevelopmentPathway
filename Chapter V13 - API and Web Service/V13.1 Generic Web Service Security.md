# V13.1 Generic Web Service Security

## 13.1.1 Verify that all application components use the same encodings and parsers to avoid parsing attacks that exploit different URI or file parsing behavior that could be used in SSRF and RFI attacks

We moeten zorgen dat alle onderdelen van de applicatie data op dezelfde manier interpreteren. Dat betekent dat je dezelfde libraries en configuraties gebruikt voor het parsen van URLs en bestandspaden bijvoorbeeld. Dit verminderd het risico van security vulnerabilities, gaat parsing attacks tegen en mitigeert SSRF (Server-Side Request Forgery) en RFI (Remote File Inclusion) aanvallen.

Bijvoorbeeld als je een component hebt die UTF-8 gebruikt en een ander gebruikt UTF-16, kan dit tot interpretatie leiden van characters in je applicatie.

### Hoe te testen?

#### Optie 1 (manueel)

Om te testen of je applicatie verschillende encoding of parsers gebruikt is best wel een ingewikkeld proces, en is helaas niet met een simpele 'curl' of F12 actie te checken. Er zijn een aantal stappen hoe dit gezien kan worden door jezelf als ontwikkelaar, of door het SAT team:

1. Code review: het komt in een code review naar voren als er verschillende encoding of parsers worden gebruikt.
2. Je kan de [OWASP Dependency-Check](https://owasp.org/www-project-dependency-check/) gebruiken om te kijken of meerdere libraries gebruikt worden voor dezelfde doeleinden (bijvoorbeeld meerdere URL parsing libraries)
3. Dynamische analyse: je kan test cases bouwen waarbij je bijvoorbeeld URLs met verschillende encoding kan testen, om te kijken hoe de verschillende onderdelen van je applicatie deze inputs behandelen
4. Configuration review: check de configuratie bestanden (als mogelijk) van je web applicatie op bijvoorbeeld database connection strings, web server configs etc.

### Hoe te implementeren?

Het doel is om er voor te zorgen dat alle componenten van je applicatie dezelfde encoding (bij voorkeur UTF-8) en dezelfde parsing libraries gebruiken voor vergelijkbare taken.

Er is niet een enkele stap om dit voor elkaar te krijgen, maar hieronder vind je een soort checklist die je kan gebruiken om er voor te zorgen dat er meer consistentie komt in je applicatie:

1. Alle componenten gebruiken standaard UTF-8-codering
2. Goedgekeurde parser libraries worden consistent gebruikt voor het verwerken van URLs
3. Goedgekeurde parser libraries worden consistent gebruikt voor de verwerking van bestandspaden
4. Input Validation omvat controles op onverwachte coderingen
5. Databaseverbindingen zijn geconfigureerd om consistente encoding te gebruiken
6. API-requests en -replies maken gebruik van consistente codering
7. Logboekmechanismen gaan consistent om met speciale tekens
8. Integraties van derden maken gebruik van consistente methoden voor gegevenscodering
9. Het Code Review proces omvat controles op de consistentie van encoding en parsing (checken bij SAT)

## 13.1.3 Verify API URLs do not expose sensitive information, such as the API key, session tokens etc

Het is uiteraard een risico als API URLs sensitieve informatie lekken omdat hiermee aanvallen relatief eenvoudig worden. Het is dan ook de bedoeling om je APIs op een goeie manier te configureren. De informatie waar we aan refereren is onder andere:

1. API keys
2. Session tokens
3. User IDs of gebruikersnamen
4. Wachtwoorden of wachtwoord reset tokens
5. Database connection strings
6. Interne IP adressen of host namen
7. Sensitieve business logic parameters

### Hoe te testen?

#### Optie 1 (manueel)

Sensitieve informatie zou alleen in de body of POST requests moeten zitten, niet in de URL parameters. Let wel: het gaat hier om gebruiker specifieke data. Om dit te testen zijn er ook weer meerdere mogelijkheden:

1. Dit zou uit een Code Review/ Pentest moeten komen, volgens mij alleen Server-Side (checken bij SAT?)
2. **Handmatige inspectie**: je kan zelf kijken in de API Endpoint definities en client-side code waar API calls in staan
3. Aan de client-side kan je via de DevTools van je browser de network activiteit controleren tijdens API calls, controleer of er sensitieve data in de Request URL staat
4. Authenticated endpoints proberen te benaderen zonder correcte credentials: check de redirect URLs voor eventuele sensitieve data
5. Controleer hoe de API session tokens behandeld: voornamelijk in redirects moeten er geen tokens in de URL staan
6. **Rate Limiting Tests**: Probeer de rate limits te overschrijven en controleer of er geen sensitieve data in de error responses staan
7. **Foutmelding analyse**: Veroorzaak meerdere soorten fouten met een API en kijk of er geen sensitieve data in de error message staan

### Hoe te implementeren?

Hier ook helaas geen kant en klaar antwoord. We zouden kunnen zeggen 'zorg dat er geen sensitieve data lekt via je API', maar daar ben je niet bij geholpen. Dus hieronder vind je een (wederom) soort checklist die je kan gebruiken in je dagelijks werk:

1. Ga door met wat we nu ook doen: integreer Security Checks in je Development Lifecyle
2. Integreer API security scanners in je pipeline (voorbeelden?) die continue checken, niet alleen laten controleren tijdens Pentests & code reviews
3. Gebruik IDE plugins en linters die potentiele security issues & mogelijke sensitieve data in URLs kunnen detecteren
4. Zorg voor API design standaarden
5. Gebruik waar mogelijk het vier ogen principe, laat een collega meekijken met je code
6. **Threat Modeling**: dit is op initiatief van de Security Liaison maar vereist wel medewerking en hulp van de ontwikkelaars
