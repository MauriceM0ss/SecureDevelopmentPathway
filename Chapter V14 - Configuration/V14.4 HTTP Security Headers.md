# V14.4 HTTP Security Headers

## 14.4.1 Verify that every HTTP response contains a Content-Type header. Also specify a safe character set (e.g., UTF-8, ISO-8859-1) if the content types are text/*, /+xml and application/xml. Content must match with the provided Content-Type header

Een **Content-Type Header** is belangrijk om te specificeren wat voor inhoud de browser kan verwachten.

* Bijvoorbeeld met 'text/html' weet de browser het om HTML inhoud gaat. Hierdoor zal de browser de tekst niet verkeerd kunnen interpreteren en voorkom je bijvoorbeeld een XSS aanval (bijvoorbeeld als een hacker een Javascript script meestuurt in een pagina die geen Content-Type heeft 'text/html' zou dit script kunnen laten uitvoeren).
* Hetzelfde geldt voor de tekenset zoals 'UTF-8'; als je deze meegeeft aan de Content-Type header zal de browser deze niet verkeerd kunnen interpreteren.
* Als laatste voorkomt dit ook 'MIME-sniffing' (nee, geen Memes), hiermee voorkom je dat de browser zelf gaat raden welk type inhoud wordt geserveerd.

Naast de security voordelen heeft het ook als voordeel dat je zeker weet dat de browser de content correct kan weergeven.

### Hoe te testen?

#### Optie 1 (manueel)

1. Open de te testen pagina in je browser, en open de DevTools (F12)
2. Open de 'Network' tab, en refresh de pagina
3. De 'Network' tab wordt nu gevuld; het bovenste document is het als het goed is het HTML document (met als type 'Document')
4. Selecteer de 'Headers' tab binnen 'Network' en zoek naar de Repsonse-Header 'Content-Type'
5. Controleer of de inhoud (als aanwezig) overeenkomt met wat jouw HTML document bevat

#### Optie 2 (via CURL)

Het is ook mogelijk om vanuit een terminal het volgende commando uit te voeren:

```bash
curl -s -D- https://example.nl | grep -i Content-Type
```

### Hoe te implementeren?

1. Zorg dat je HTML pagina de Response-Header 'Content-Type' bevat, en dat deze correct gevuld is.
2. Voor meer informatie zie de best practice pagina voor Content-Type: [Best Practice - Security Headers - Content-Type.md](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20Content-Type.md)

## 14.4.2 Verify that all API responses contain a Content-Disposition: attachment; filename="api.json" header (or other appropriate filename for the content type)

De '**Content-Disposition**' header zorgt er voor dat de browser de inhoud van de pagina correct kan weergeven, bijvoorbeeld een inline document in je pagina, of voor het afdwingen van een download. Denk aan bijvoorbeeld een PDF document waarvan je wilt dat de gebruiker deze in de pagina zelf moet kunnen zien (Content-Disposition: inline) of dat het een ZIP bestand betreft die gedownload moet worden (Content-Disposition: attachment; filename="voorbeeld.zip").

### Hoe te testen?

#### Optie 1 (via Curl)

Open een terminal en voer het volgende commando uit:

```bash
curl -s -D- https://example.nl | grep -i Content-Disposition
```

### Hoe te implementeren?

Zie voor de implementatie hiervan de Best Practice pagina over [Content-Disposition](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20Content-Disposition.md)

## 14.4.3 Verify that a Content Security Policy (CSP) response header is in place that helps mitigate impact for XSS attacks like HTML, DOM, JSON, and JavaScript injection vulnerabilities

De '**Content Security Policy**' header is een beveiligingsheader die wordt gebruikt om webapplicaties te beschermen tegen beveiligingsbedreigingen zoals XSS (Cross Site Scripting) aanvallen en CSI (Cross-Site Injection) aanvallen. Met een CSP-header kan je specificeren welke bronnen een webpagina mag laden, waaronder scripts, afbeeldingen, en media.

Als een browser een pagina met een CSP-header laadt, zal het alleen content van de opgegeven bronnen laden. Als er een poging wordt gedaan om content te laden van een bron die niet is opgegeven in de CSP-header, dan zal de browser deze content blokkeren. Dit is met name belangrijk om bijvoorbeeld JavaScript scripts alleen van betrouwbare bronnen te laden.

De CSP-Header is voornamelijk bedoelt om XSS (Cross-Site Scripting), clickjacking, en cross-site leak kwetsbaarheden tegen te gaan.

### Hoe te testen?

#### Optie 1 (via CSP evaluator)

Ga bijvoorbeeld naar <https://csp-evaluator.withgoogle.com> en voer de URL of CSP Heaeder van je webpagina/ applicatie in. Hier krijg je in het geval van een gedeelde URL de 'Content-Security-Policy' inhoud te zien (als deze aanwezig is) en gelijk advies op basis van de huidige standaarden.

### Hoe te implementeren?

Om te beginnen met de basis syntax zou je de onderstaande header moeten toevoegen aan je HTML document:

```text
Content-Security-Policy: <policy-directive>; <policy-directive>
```

Voor de best practice om hoe deze CSP-Header in te richten zie de [Best Practice - Security Headers - CSP](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20CSP.md)

Voor meer informatie kijk op de [OWASP Content-Security-Policy cheat sheet](https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html)

## 14.4.4 Verify that all responses contain a X-Content-Type-Options: nosniff header

Met de '**X-Content-Type-Options: nosniff**' header voorkom je dat de browsers zelf een MIME Type sniffing gaan uitvoeren, omdat je met deze header aangeeft dat de MIME types gedefinieerd zijn. Hiermee voorkom je dat er XSS aanvallen uitgevoerd kunnen worden, bijvoorbeeld dat een kwaadwillende een stuk JavaScript als een ander type bestand kan laten verschijnen (bijvoorbeeld een afbeelding) waardoor de browser het script uitvoert.

### Hoe te testen?

#### Optie 1 (manueel)

1. Check of je de header '**Content-Type**' gebruikt:

    ```bash
    curl -s -D- https://example.nl | grep -i Content-Type
    ```

2. En controleer of je de '**X-Content-Type-Options**' header gebruikt:

    ```bash
    curl -s -D- https://example.nl | grep -i nosniff
    ```

### Hoe te implementeren?

Zie voor de implementie het best practice document [Best Practice - Security Headers - X-Content-Type-Options](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20X-Content-Type-Options.md)

## 14.4.5 Verify that a Strict-Transport-Security header is included on all responses and for all subdomains, such as Strict-Transport-Security: max-age=15724800; includeSubdomains

Met de '**Strict-Transport-Security**' header zorg je er voor dat de website alleen via HTTPS toegankelijk is voor browsers. Alle pogingen om de website via HTTP te benaderen worden automatisch doorgezet naar HTTPS.
Dit zorgt er voor dat je geen Man-in-the-Middle (MitM) attacks krijgt waarbij kwaadwillenden het onversleuteld verkeer kunnen onderscheppen of manipuleren.

### Hoe te testen?

#### Optie 1 (manueel)

1. Via een terminal verstuur het volgende commando:

    ```bash
    curl -s -D- https://example.nl | grep -i strict
    ```

2. Het verwachte response is:

    ```text
    Strict-Transport-Security: max-age=31536000
    ```

### Hoe te implementeren?

1. Voeg de onderstaande HTTP Header toe aan je HTML document:

    ```text
    Strict-Transport-Security: max-age=31536000; includeSubDomains
    ```

    * **max-age=31536000** specificeert dat browsers de instructie om de website alleen via HTTPS te bezoeken gedurende een jaar (31.536.000 seconden) in hun cache moeten opslaan.
    * **includeSubDomains** zorgt ervoor dat de HSTS-instructie ook van toepassing is op alle subdomeinen van de website.

Voor de best practice om hoe deze HSTS-Header in te richten zie de [Best Practice - Security Headers - CSP](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20HSTS.md)

## 14.4.6 Verify that a suitable Referrer-Policy header is included to avoid exposing sensitive information in the URL through the Referer header to untrusted parties

Om er voor te zorgen dat een website browser informatie van de herkomst van een gebruiker niet kan doorsturen, moet je de '**Referrer-Policy**' implementeren. Deze header zorgt er voor dat er geen referrer informatie wordt verstuurd indien een externe link wordt geopend.

### Hoe te testen?

#### Optie 1 (manueel)

1. Open een terminal en verstuur het volgende commando:

    ```bash
    curl -s -D- https://example | grep -i referrer
    ```

2. De verwachte response is:

    ```text
    Referrer-Policy: no-referrer
    ```

### Hoe te implementeren?

1. Voeg de onderstaande HTTP Header toe aan je HTML document:

    ```text
    Referrer-Policy: no-referrer
    ```

Voor de best practice en meer informatie over deze Referrer-Policy header zie de [Best Practice - Security Headers - CSP](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20Referrer-Policy.md)

## 14.4.7 Verify that the content of a web application cannot be embedded in a third-party site by default and that embedding of the exact resources is only allowed where necessary by using suitable Content-Security-Policy: frame-ancestors and X-Frame-Options response headers

Het implementeren van de '**Content-Security-Policy**' directive '**frame-ancestors**' of de '**X-Frame-Options**' header in je HTML-document is nodig om te beschermen tegen onder andere clickjacking-aanvallen. Bijvoorbeeld: een kwaadwillende kan een transparante of onzichtbare pagina (frame) op jouw legitieme website plaatsen. Op deze manier kan een kwaadwillende acties onderscheppen en uitvoeren namens de ingelogde gebruiker.

Door de '**frame-ancestors**' of de '**X-Frame-Options**' headers te gebruiken op je applicatie, kan deze alleen in een legitieme iframe geladen worden doordat je de bron voor frame ancestors zelf opgeeft.

### Hoe te testen?

#### Optie 1 (manueel)

1. Open een terminal en voer het volgende commando uit:

    ```bash
    curl -s -D- https://example.nl | grep -i frame-ancestors
    ```

### Hoe te implementeren?

1. Bijvoorbeeld op binnen je HTML Document kan je de volgende CSP Header gebruiken:

    ```text
    Content-Security-Policy: frame-ancestors 'self' https://example.nl;
    ```

2. Zorg dat je onze CSP Header best practices volgt. Zie hiervoor de link onderaan deze requirement.
3. Wanneer een website helemaal niet in iframes zou mogen draaien dan kan je de onderstaande header implementeren:

    ```text
    frame-ancestors 'none'
    ```

Voor de best practice om hoe deze HSTS-Header in te richten zie de [Best Practice - Security Headers - CSP](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20HSTS.md)

Zie ook de best practice [Best Practice - Security Headers - X-Frame-Optionms](../Best%20Practices/Best%20Practice%20-%20Security%20Headers%20-%20X-Frame-Options.md)
